# 海上溢油预测仿真系统

> Oil Spill Prediction Simulation System

基于 Lagrangian 粒子追踪法的海上溢油预测仿真 Demo，集成真实海洋气象网格数据，B/S 架构前端可视化。

- **版本**: v1.0.0
- **创建时间**: 2026-02-28
- **作者**: wangxiong

## 功能特性

- Lagrangian 粒子追踪溢油漂移模拟
- 瞬时溢油 / 持续溢油两种模式
- ERA5 真实风场数据驱动（逐小时，0.25° 分辨率）
- CMEMS 真实海流与海温数据驱动（6 小时，0.083° 分辨率）
- ERA5-Land 陆海掩膜实现岸线搁浅判定
- Leaflet.js 交互式地图 + Canvas 高性能粒子渲染
- 实时统计：扩散面积、漂移距离、蒸发/分散/乳化/搁浅

## 物理模型

| 过程 | 模型 | 说明 |
|------|------|------|
| 风漂流 | 3% 风速 + 15° Ekman 偏转 | 经典经验公式 |
| 海流输运 | CMEMS 表层流场直接驱动 | uo/vo 分量 |
| 湍流扩散 | Box-Muller 高斯随机游走 | D = 1.0 + 0.5W m²/s |
| 蒸发 | Stiver-Mackay 简化模型 | 温度/风速修正 |
| 自然分散 | Delvigne-Sweeney 简化模型 | 风速 > 5 m/s 触发 |
| 乳化 | Mackay 简化模型 | 最大含水率 70% |
| 油膜扩展 | Fay 三阶段幂律模型 | 厚度 ~ t^(-1/3) |
| 搁浅 | 陆海掩膜二值判定 | lsm > 0.5 为陆地 |

## 真实数据源

| 数据 | 来源 | 产品 |
|------|------|------|
| 10m 风场 | ECMWF ERA5 | reanalysis-era5-single-levels |
| 表层海流 | Copernicus CMEMS | GLOBAL_ANALYSISFORECAST_PHY_001_024 |
| 海表温度 | Copernicus CMEMS | GLOBAL_ANALYSISFORECAST_PHY_001_024 |
| 陆海掩膜 | ECMWF ERA5-Land | reanalysis-era5-land |

数据覆盖范围：36–40°N, 118–124°E（渤海/黄海），2024-01-15 ~ 2024-01-17

## 快速开始

### 环境要求

- Python 3.8+
- 现代浏览器（Chrome / Firefox / Safari）

### 安装与运行

```bash
# 1. 安装 Python 依赖（仅数据下载/预处理需要）
pip install -r data/requirements.txt

# 2. 下载真实数据（需 CMEMS + CDS 账号）
python data/download_cmems.py
python data/download_era5_wind.py
python data/download_landmask.py

# 3. 预处理 NetCDF → JSON
python data/preprocess.py

# 4. 启动服务器
python server.py
```

浏览器访问 http://localhost:3000

> 如果跳过步骤 1-3，系统会自动降级为均匀标量场模式（使用滑块手动设置风速/流速）。

## 项目结构

```
├── server.py                   # HTTP 服务器 (Python)
├── public/
│   ├── index.html              # 主页面
│   ├── css/style.css           # 暗色主题样式
│   └── js/
│       ├── simulation.js       # 核心仿真引擎
│       └── app.js              # 前端控制器
├── data/
│   ├── download_*.py           # 数据下载脚本
│   ├── preprocess.py           # NetCDF → JSON
│   ├── raw/                    # 原始 NetCDF
│   └── processed/              # JSON 网格数据
└── docs/
    └── technical-document.md   # 技术文档
```

## 技术文档

详细算法说明、公式推导和结果核查指南请参考 [docs/technical-document.md](docs/technical-document.md)。

---

## 已知不足与优化方向

### 一、物理模型层面

#### 1. 风化过程未按粒子个体化

**现状**: 蒸发、分散、乳化三个风化过程基于全局模拟时间 `hoursElapsed` 统一计算，所有活跃粒子在同一时刻共享相同的蒸发率/分散率。

**问题**: 在持续溢油模式下，t=0h 释放的粒子和 t=11h 释放的粒子在 t=12h 时刻获得相同的蒸发比例，但实际上前者已暴露 12 小时而后者仅暴露 1 小时，风化程度应有显著差异。

**优化方向**: 将风化计算移入逐粒子循环，基于各粒子自身年龄 `p.age` 计算独立的蒸发/分散/乳化状态。

#### 2. 海温数据未实际参与风化计算

**现状**: CMEMS `thetao` 海温网格已下载并加载至前端（`tempGrid`），但蒸发模型中仍使用滑块设定的全局水温值 `this.waterTemp`（默认 18°C），相关插值代码被注释（simulation.js 第 536-539 行）。

**问题**: 渤海冬季水温空间差异大（近岸 2-4°C，外海 8-10°C），统一使用 18°C 会高估近岸蒸发速率。

**优化方向**: 在逐粒子循环中插值 `tempGrid.sample('thetao', p.lat, p.lng, gridT)`，将局部海温传入 `_calcEvaporation()`。

#### 3. 网格模式下风化用风速为硬编码常量

**现状**: 使用网格数据时，风化模型中的代表风速硬编码为 `5.0 m/s`（simulation.js 第 483 行）。

**问题**: 实际风速时空变化剧烈（ERA5 数据显示该区域范围 0-13 m/s），固定值无法反映局部风速对蒸发和乳化的真实影响。

**优化方向**: 在逐粒子循环中取各粒子位置的插值风速用于风化计算（或采用区域平均风速）。

#### 4. 缺少潮汐动力

**现状**: 海流仅由 CMEMS 全球模型提供（6 小时分辨率），不包含潮汐分量。

**问题**: 渤海为强潮海域，M2 分潮流速可达 0.3-1.0 m/s，与平均海流量级相当。缺少潮流会导致短期（< 12h）漂移轨迹与实际偏差较大，且无法重现潮汐振荡导致的"之字形"轨迹。

**优化方向**: 引入区域潮汐模型（如 TPXO、FES2014 调和常数），在运行时叠加潮流分量；或使用包含潮汐的高分辨率区域海洋模型。

#### 5. 缺少 Stokes 漂流

**现状**: 仅考虑风漂流（3% 风速）和欧拉海流，未包含波浪引起的质量输运（Stokes drift）。

**问题**: Stokes 漂流速度约为风速的 1-2%，方向与波浪传播方向一致，对表面漂移物的贡献不可忽略。

**优化方向**: 接入 ERA5 的 Stokes 漂流分量（`ust`/`vst`），或基于波浪谱参数化计算。

#### 6. 纯二维模型，无垂向过程

**现状**: 所有粒子固定在海面，无垂向维度。

**问题**: 在强风（> 10 m/s）条件下，破碎波可将油滴卷入水柱（夹卷），油滴在浮力作用下重新上浮。这一过程影响水面油量、分散率和水下污染扩散。此外，重质燃料油或高度风化油密度可能超过海水而发生沉降。

**优化方向**: 增加垂向分层（至少 2-3 层），建立夹卷-上浮模型，并加入密度演化判断沉降。

#### 7. 风漂系数固定不变

**现状**: 风漂系数固定为 3%，Ekman 偏转角固定为 15°。

**问题**: 实际风漂系数随油膜厚度（厚油膜 3-4%，薄虹彩 1-2%）、乳化程度（高粘度乳液可达 4-6%）和风速本身变化。偏转角也受纬度和风速影响。

**优化方向**: 根据油膜状态动态调整风漂系数，或采用更精细的风-油耦合模型。

#### 8. 搁浅模型过于简化

**现状**: 搁浅为一次性二值判定——粒子到达陆地后永久搁浅，回退到前一位置，不再参与漂移。

**问题**:
- 无**再浮机制**: 搁浅油可在涨潮或风暴浪作用下重新进入水体
- 无**岸线类型区分**: 岩石岸、沙滩、泥滩对油的滞留能力差异很大
- 无**岸线容量**: 已饱和的海岸可能不再吸附更多油
- 无**潮间带动态**: 潮汐涨落改变有效海岸线位置

**优化方向**: 引入岸线分类数据（如 ESI 环境敏感指数），建立基于岸线类型的吸附-释放模型，耦合潮汐水位变化。

#### 9. 陆海掩膜分辨率粗糙

**现状**: 使用 ERA5-Land 0.1°（约 11 km）分辨率掩膜。

**问题**: 11 km 网格无法分辨小型岛屿、港湾、河口等地形细节，导致近岸搁浅判定精度不足。

**优化方向**: 采用高分辨率海岸线数据（如 GSHHG 全分辨率约 100-200m，或 OpenStreetMap 矢量海岸线），生成精细掩膜网格。

#### 10. 扩散系数参数化过于简单

**现状**: 湍流扩散系数 `D = 1.0 + 0.5 × W`（W 为风速），各粒子各方向使用相同值。

**问题**: 实际海洋湍流扩散具有尺度依赖性（Richardson 扩散），且各向异性（沿岸和离岸方向不同）。当前参数化未考虑流场梯度和海洋混合层深度。

**优化方向**: 采用 Smagorinsky 参数化（基于速度梯度张量）或尺度依赖扩散方案 `D ~ L^(4/3)`。

#### 11. Fay 扩展模型不完整

**现状**: 仅实现重力-粘性阶段的幂律衰减 `h ~ t^(-1/3)`。

**问题**: Fay 模型完整包含三个阶段——重力-惯性（初期快速扩展）、重力-粘性（中期）、表面张力-粘性（后期薄膜），当前缺少初期和末期。且扩展模型未与风化过程耦合（蒸发减少油量应减缓扩展）。

**优化方向**: 实现完整三阶段 Fay 模型，引入扩展-风化双向耦合。

### 二、数据质量层面

#### 12. CMEMS 海流时间分辨率不足

**现状**: CMEMS 全球产品为 6 小时间隔。

**问题**: 6 小时间隔无法分辨惯性振荡（38°N 约 17 小时周期）和潮汐流（12.42 小时周期），线性插值会产生平滑化误差。

**优化方向**: 使用 CMEMS 逐小时产品（如 `GLOBAL_MULTIYEAR_PHY_001_030`），或接入高时间分辨率的区域模型。

#### 13. 海流 NaN 处理可能引入误差

**现状**: 预处理中将 NetCDF 的 NaN（陆地/无数据网格点）替换为 0.0。

**问题**: 近岸网格点在 CMEMS 中常为 NaN（海陆混合），替换为 0 会造成海岸附近出现人为的"零流速区"，油膜在近岸滞留时间被高估。

**优化方向**: 对 NaN 网格点进行最近有效值外推填充，或在插值中检测并跳过无效节点。

#### 14. 数据覆盖区域固定

**现状**: 网格数据仅覆盖 36-40°N, 118-124°E，预设场景中的南海和东海位置无真实数据支持。

**优化方向**: 按场景动态下载对应区域数据，或预下载中国近海全域数据。

### 三、工程应用层面

#### 15. 无不确定性量化（集合模拟）

**现状**: 单次确定性运行，结果无置信度评估。

**问题**: 溢油预测受初始条件、气象预报误差、模型参数等多重不确定性影响，单次运行结果可能具有较大偏差，决策者无法评估风险概率。

**优化方向**: 实现集合模拟（Ensemble），通过扰动风场、海流、风漂系数等参数运行多次（如 50-100 次），输出概率密度图（如"72 小时内油膜到达概率"热力图）。

#### 16. 无结果导出功能

**现状**: 模拟结果仅可在浏览器内查看，无法导出。

**优化方向**: 支持导出粒子轨迹为 GeoJSON/KML，统计时间序列为 CSV，油膜影响范围为 Shapefile，便于 GIS 分析和报告编制。

#### 17. 无卫星观测数据同化

**现状**: 模型为纯前向预测，无法融合实际观测修正轨迹。

**优化方向**: 接入 SAR（合成孔径雷达）或光学卫星影像检测实际油膜位置，通过数据同化（如集合卡尔曼滤波）修正模型预测。

#### 18. 无反向追踪能力

**现状**: 仅支持正向预测（给定溢油源预测去向）。

**问题**: 实际应急中常需从发现的油膜反推溢油源位置和时间。

**优化方向**: 实现反向粒子追踪（将速度场取反，从观测位置回溯），支持溢油源识别。

#### 19. 无应急响应辅助工具

**现状**: 仅展示油膜漂移预测，不支持应急措施模拟。

**优化方向**:
- 围油栏部署模拟（在指定位置设置屏障，阻止粒子通过）
- 分散剂喷洒效果模拟（增大分散率参数）
- 机械回收模拟（在区域内移除粒子）
- 敏感资源标注（养殖区、保护区、取水口等）

#### 20. 前端计算性能瓶颈

**现状**: 全部物理计算在浏览器主线程 JavaScript 中执行。

**问题**: 粒子数 > 5000 时每帧计算量大，可能造成 UI 卡顿；网格插值在逐粒子循环中是热点。

**优化方向**: 使用 Web Worker 将物理计算移至后台线程；或使用 WebGL Compute Shader / WebGPU 进行 GPU 并行粒子计算。

---

### 改进优先级建议

| 优先级 | 项目 | 预期收益 |
|--------|------|---------|
| P0 (高) | #1 风化按粒子个体化 | 修复持续溢油模式下风化计算的原理性错误 |
| P0 (高) | #2 接入真实海温 | 代码已就绪，仅需取消注释并传参 |
| P0 (高) | #3 修复网格模式风化风速 | 消除硬编码 5.0 m/s 带来的系统偏差 |
| P1 (中) | #4 潮汐动力 | 渤海场景影响显著 |
| P1 (中) | #8 搁浅模型增强 | 对近岸预测精度有实质性提升 |
| P1 (中) | #15 集合模拟 | 对决策支持价值极高 |
| P2 (低) | #5 Stokes 漂流 | 提升漂移精度 5-15% |
| P2 (低) | #16 结果导出 | 工程实用性 |
| P2 (低) | #6 垂向过程 | 强风场景重要 |

---

## 许可证

MIT License
